<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ØªÙ‚Ø±ÙŠØ± Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø´Ø­Ù†</title>
  <link rel="stylesheet" href="css/modern-styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="app-layout">
    <!-- Mobile Header -->
    <header class="mobile-header">
      <div class="brand">
        <img class="logo" src="logo/logo.png" alt="logo" />
        <h1>ØªÙ‚Ø±ÙŠØ± Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø´Ø­Ù†</h1>
      </div>
      <button class="menu-toggle" aria-label="ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </header>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Page Header -->
      <div class="search-section">
        <h2 class="text-xl font-bold text-primary mb-3">ğŸ’³ ØªÙ‚Ø±ÙŠØ± Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø´Ø­Ù†</h2>
        <p class="text-sm text-muted mb-3">Ø¨Ø§Ù„Ù†Ø³Ø¨Ø© Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© ØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ Ù…ØªÙˆØ³Ø· Ø§Ø®ØªÙ„Ø§Ù Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</p>
        <div class="search-row">
          <input id="filter" class="search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ù†ÙˆØ¹ Ø§Ù„Ø´Ø­Ù†..." />
          <div class="text-sm text-gray">Ø¹Ø±Ø¶ <span id="count" class="count-badge">0</span> Ù†ÙˆØ¹</div>
        </div>
      </div>

      <!-- Totals Section -->
      <div class="totals-section" id="totals">
        <div class="totals-grid">
          <div class="total-item">
            <div class="total-label">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ</div>
            <div class="total-value" id="total_all">0</div>
          </div>
          <div class="total-item">
            <div class="total-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©</div>
            <div class="total-value" id="total_comm">0</div>
          </div>
          <div class="total-item">
            <div class="total-label">Ø¨Ø¹Ø¯ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©</div>
            <div class="total-value" id="total_after_comm">0</div>
          </div>
        </div>
      </div>

      <!-- Table Section -->
      <div class="table-container">
        <div class="table-wrapper">
          <table id="tbl" class="modern-table">
            <thead></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </main>
  </div>

  <script src="js/app.js"></script>
  <script src="js/modern-ui.js"></script>
  <script>
    (async function(){
      try {
        // Use the CSV summary JSON
        const data = await fetch('data/summary_by_recharge_type.json').then(r=>r.json());
        
        // Sort data by Total descending
        data.sort((a, b) => {
          const totalA = parseNumber(getVal(a, ['Total','total_all']) || '0');
          const totalB = parseNumber(getVal(b, ['Total','total_all']) || '0');
          return totalB - totalA;
        });
        
        const table = document.getElementById('tbl');
        const thead = table.querySelector('thead');
        const tbody = table.querySelector('tbody');
        
        thead.innerHTML = `
          <tr>
            <th>Ù†ÙˆØ¹ Ø§Ù„Ø´Ø­Ù†</th>
            <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
            <th>Ø§Ù„Ø¹Ø¯Ø¯</th>
            <th>Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©</th>
            <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©</th>
            <th>Ø¨Ø¹Ø¯ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©</th>
            <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
          </tr>
        `;

        function render(filterText=''){
          tbody.innerHTML='';
          const q = String(filterText || '').trim().toUpperCase();
          const rows = data.filter(r=> String(getVal(r, ['Recharge type LYD','ï»¿Recharge type LYD','recharge_type','Recharge type'])||'').toUpperCase().includes(q));
          
          let sum_total_all = 0;
          let sum_total_comm = 0;
          let sum_total_after_comm = 0;
          
          rows.forEach(row=>{
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td><strong class="text-primary">${escapeHtml(getVal(row, ['Recharge type LYD','ï»¿Recharge type LYD','recharge_type','Recharge type'])||'')}</strong></td>
              <td class="font-bold">${formatTableNumber(getVal(row, ['Total Amount (per row avg)','Total Amount (per row avg)'])||'')}</td>
              <td class="text-center">${escapeHtml(getVal(row, ['count','cnt'])||'')}</td>
              <td class="text-accent">${formatTableNumber(getVal(row, ['COMMISSION (per row avg)','commission_per_row'])||'')}</td>
              <td class="font-bold text-accent">${formatTableNumber(getVal(row, ['Total-Comm','total_comm'])||'')}</td>
              <td class="font-bold text-primary">${formatTableNumber(getVal(row, ['Total-After-Comm','total_after_comm'])||'')}</td>
              <td class="font-bold text-lg">${formatTableNumber(getVal(row, ['Total','total_all'])||'')}</td>
            `;
            tbody.appendChild(tr);
            
            sum_total_all += parseNumber(getVal(row, ['Total','total_all','Total '])||'0');
            sum_total_comm += parseNumber(getVal(row, ['Total-Comm','total_comm','Total-Comm '])||'0');
            sum_total_after_comm += parseNumber(getVal(row, ['Total-After-Comm','total_after_comm','Total-After-Comm '])||'0');
          });
          
          document.getElementById('count').innerText = rows.length;
          document.getElementById('total_all').innerText = formatNumber(sum_total_all);
          document.getElementById('total_comm').innerText = formatNumber(sum_total_comm);
          document.getElementById('total_after_comm').innerText = formatNumber(sum_total_after_comm);
          
          // Add loading animation
          AnimationUtils.fadeIn(table, 300);
        }

        document.getElementById('filter').addEventListener('input', e=> {
          render(e.target.value);
        });
        
        // Initial render
        render('');
        
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
        document.querySelector('.main-content').innerHTML += `
          <div class="search-section text-center">
            <h3 class="text-error">âš ï¸ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
            <p class="text-muted">ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„Ù summary_by_recharge_type.json</p>
          </div>
        `;
      }
    })();
  </script>
</body>
</html>